<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Guide - IceWiFi</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
<header>
    <div class="header-content">
        <h1>IceWiFi </h1>
        <nav>
            <a href="index.html">Start</a>
            <a href="admin-guide.html">Admin Guide</a>
            <a href="user-guide.html">User Guide</a>
            <a href="network-topology.html">Topologie</a>
            <a href="backup-restore.html">Backup</a>
            <a href="troubleshooting.html">Troubleshooting</a>
        </nav>
    </div>
</header>
<main>

<h2>Admin Guide</h2>

<section class="card">
    <h3>VLAN-Konfiguration</h3>
    <p>Das Netzwerk ist in mehrere VLANs segmentiert, die ueber MikroTik SwOS Switches getrunked werden.</p>

    <h4>VLAN-Uebersicht</h4>
    <table>
        <tr><th>VLAN</th><th>Subnet</th><th>Gateway</th><th>Zweck</th><th>DHCP</th></tr>
        <tr><td>11</td><td>10.10.0.0/24</td><td>10.10.0.2 (Sophos)</td><td>Sophos Internal</td><td>Nein</td></tr>
        <tr><td>12</td><td>10.10.10.0/24</td><td>10.10.10.1 (USG)</td><td>IoT / UniFi</td><td>USG</td></tr>
        <tr><td>13</td><td>10.10.13.0/24</td><td>10.10.13.1 (NUC)</td><td>Tor Transparent Proxy</td><td>dnsmasq-tor</td></tr>
        <tr><td>666</td><td>192.168.178.0/24</td><td>192.168.x.1 (Fritz!Box)</td><td>Internet / Fritz!Box</td><td>Fritz!Box</td></tr>
    </table>
</section>

<section class="card">
    <h3>Switch Port-Zuordnung (Arbeitszimmer)</h3>
    <table>
        <tr><th>Port</th><th>Geraet</th><th>Modus</th><th>PVID</th><th>VLANs</th></tr>
        <tr><td>19</td><td>CK+ Cloud Key</td><td>TRUNK</td><td>12</td><td>1, 11, 12, 13</td></tr>
        <tr><td>20</td><td>USG WAN</td><td>TRUNK</td><td>666</td><td>666</td></tr>
        <tr><td>21</td><td>USG LAN</td><td>TRUNK</td><td>12</td><td>1, 10, 11, 12</td></tr>
        <tr><td>22</td><td>U6+ Arbeitszimmer</td><td>TRUNK</td><td>12</td><td>1, 10, 11, 12, 13</td></tr>
        <tr><td>24</td><td>NUC-HA</td><td>TRUNK</td><td>666</td><td>Alle</td></tr>
        <tr><td>25-26</td><td>SFP+ Backbone</td><td>TRUNK</td><td>666</td><td>Alle</td></tr>
    </table>
</section>

<section class="card">
    <h3>Switch Port-Zuordnung (Keller)</h3>
    <table>
        <tr><th>Port</th><th>Geraet</th><th>Modus</th><th>PVID</th><th>VLANs</th></tr>
        <tr><td>1-4</td><td>ESXi7 (vmnic0-3)</td><td>TRUNK</td><td>1</td><td>1, 11, 12, 666</td></tr>
        <tr><td>5</td><td>ESXi7 iLO</td><td>ACCESS</td><td>666</td><td>-</td></tr>
        <tr><td>8</td><td>KI01</td><td>TRUNK</td><td>12</td><td>1, 12</td></tr>
        <tr><td>23</td><td>U6+ Keller</td><td>TRUNK</td><td>12</td><td>1, 12, 13</td></tr>
        <tr><td>24</td><td>Fritz!Box</td><td>ACCESS</td><td>666</td><td>-</td></tr>
        <tr><td>25</td><td>SFP+ nach 1.OG</td><td>TRUNK</td><td>666</td><td>Alle</td></tr>
    </table>
</section>

<section class="card">
    <h3>UniFi Controller (CK+)</h3>
    <p>Der UniFi Controller laeuft auf einem Cloud Key Plus (UCK G2+) im VLAN 12.</p>
    <ul>
        <li><strong>Zugriff vom NUC:</strong> via socat-Proxy auf <code>127.0.0.1:8443</code></li>
        <li><strong>Direkt:</strong> <code>https://10.10.10.10</code> (aus VLAN 12)</li>
        <li><strong>Verwaltete Geraete:</strong> USG 3P, 2x U6+ APs</li>
        <li><strong>MongoDB:</strong> Port 27117, Datenbank <code>ace</code></li>
    </ul>

</section>

<section class="card">
    <h3>Tor Transparent Proxy (VLAN 13)</h3>
    <p>VLAN 13 routet allen Traffic ueber das Tor-Netzwerk. Geraete im SSID "Bad!Bad" erhalten
    automatisch eine IP via DHCP und werden transparent durch Tor geleitet.</p>

    <h4>Komponenten</h4>
    <table>
        <tr><th>Service</th><th>Funktion</th><th>Config</th></tr>
        <tr><td><code>tor@default</code></td><td>Tor Daemon (TransPort 9040, DNSPort 5399)</td><td><code>/etc/tor/torrc</code></td></tr>
        <tr><td><code>dnsmasq-tor</code></td><td>DHCP fuer VLAN 13</td><td><code>/etc/dnsmasq.d/tor-vlan13.conf</code></td></tr>
        <tr><td><code>iptables-tor</code></td><td>NAT-Redirect DNS→5399, TCP→9040</td><td>systemd ExecStart</td></tr>
    </table>

    <h4>Tor-Konfiguration</h4>
    <pre><code>SocksPort 0
VirtualAddrNetworkIPv4 10.192.0.0/10
AutomapHostsOnResolve 1
TransPort 10.10.13.1:9040
DNSPort 10.10.13.1:5399</code></pre>
</section>

<section class="card">
    <h3>Firewall (USG)</h3>
    <p>Die USG Firewall-Regeln werden ueber die MongoDB auf dem CK+ verwaltet.</p>

    <h4>LAN_IN Regelkette</h4>
    <table>
        <tr><th>Index</th><th>Aktion</th><th>Beschreibung</th></tr>
        <tr><td>2000</td><td>RETURN</td><td>ESTABLISHED/RELATED aus NUC-Subnet</td></tr>
        <tr><td>2001</td><td>RETURN</td><td>NEW TCP zu NUC Services (1883, 8883, 8123)</td></tr>
        <tr><td>2002</td><td>RETURN</td><td>DNS (TCP+UDP) zur USG</td></tr>
        <tr><td>2003</td><td>RETURN</td><td>NTP (UDP)</td></tr>
        <tr><td>6001</td><td>RETURN</td><td>Allow 10.10.10.0/24 Traffic</td></tr>
        <tr><td>10000</td><td>RETURN</td><td>Default</td></tr>
    </table>
</section>

<section class="card">
    <h3>Sophos XG Firewall</h3>
    <p>Die Sophos Firewall sitzt zwischen VLAN 11 (internal), VLAN 12 (IoT) und VLAN 666 (Internet).</p>
    <table>
        <tr><th>Interface</th><th>IP</th><th>VLAN</th></tr>
        <tr><td>eth0</td><td>10.10.0.2</td><td>11 (Internal)</td></tr>
        <tr><td>eth1</td><td>192.168.x.154</td><td>666 (Internet)</td></tr>
        <tr><td>eth2</td><td>10.10.10.2</td><td>12 (IoT)</td></tr>
    </table>

</section>

<section class="card">
    <h3>Home Assistant Integration</h3>
    <p>Home Assistant laeuft als Docker-Container auf dem NUC und ist ueber die Bridge-IP erreichbar.</p>
    <ul>
        <li><strong>Config:</strong> <code>/var/lib/homeassistant/homeassistant/</code></li>
        <li><strong>Web:</strong> <code>http://192.168.x.108:8123</code></li>
        <li><strong>UniFi Package:</strong> <code>packages/unifi.yaml</code></li>
        <li><strong>Netzwerk Dashboard:</strong> <code>dashboards/network.yaml</code></li>
    </ul>

    <h4>Systemd Services (IceWiFi)</h4>
    <pre><code># Status pruefen
systemctl status socat-unifi dnsmasq-tor iptables-tor

# Neustarten
systemctl restart socat-unifi dnsmasq-tor iptables-tor

# Logs
journalctl -u socat-unifi -u dnsmasq-tor -u iptables-tor --since today</code></pre>
</section>

</main>
<footer>
    <p>IceWiFi Netzwerk-Dokumentation | Generiert: 2026-02-01 08:58:30</p>
    <p><a href="https://github.com/icepaule/IceWiFi">GitHub</a></p>
</footer>
</body>
</html>